<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€„ éº»å°†è¯†åˆ«ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 2.5em;
        }
        
        h1::before {
            content: 'ğŸ€„ ';
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #f8f9fa;
            border-color: #764ba2;
        }
        
        .upload-area.dragover {
            background: #e8f4fd;
            border-color: #3498db;
        }
        
        .preview-area {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        
        .tile-preview {
            max-width: 200px;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .result-area {
            display: none;
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .tile-info {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .tile-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin: 5px;
        }
        
        .character { background: #3498db; }  /* ä¸‡å­ - è“è‰² */
        .dot { background: #2ecc71; }       /* ç­’å­ - ç»¿è‰² */
        .bamboo { background: #9b59b6; }    /* æ¡å­ - ç´«è‰² */
        .wind { background: #e74c3c; }      /* é£ç‰Œ - çº¢è‰² */
        .dragon { background: #f39c12; }    /* ä¸‰å…ƒç‰Œ - æ©™è‰² */
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }
        
        button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .sample-tiles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .sample-tile {
            width: 60px;
            height: 80px;
            background: #f0f0f0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #ddd;
        }
        
        .sample-tile:hover {
            transform: scale(1.1);
            border-color: #667eea;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>éº»å°†è¯†åˆ«ç³»ç»Ÿ</h1>
        
        <div class="upload-area" id="dropArea">
            <h3>ğŸ´ ä¸Šä¼ éº»å°†å›¾ç‰‡</h3>
            <p>æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤åŒºåŸŸï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('fileInput').click()">é€‰æ‹©å›¾ç‰‡</button>
        </div>
        
        <div class="preview-area" id="previewArea">
            <h3>å›¾ç‰‡é¢„è§ˆ</h3>
            <img id="tilePreview" class="tile-preview" alt="éº»å°†é¢„è§ˆ">
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨è¯†åˆ«ä¸­...</p>
        </div>
        
        <div class="result-area" id="resultArea">
            <h3>è¯†åˆ«ç»“æœ</h3>
            <div id="resultContent"></div>
        </div>
        
        <div class="sample-tiles">
            <h4 style="width: 100%; text-align: center; margin: 10px 0;">ç‚¹å‡»æµ‹è¯•ç¤ºä¾‹ï¼š</h4>
            <div class="sample-tile" data-tile="m1">ğŸ€‡</div>
            <div class="sample-tile" data-tile="m5">ğŸ€</div>
            <div class="sample-tile" data-tile="p1">ğŸ€™</div>
            <div class="sample-tile" data-tile="p9">ğŸ€¡</div>
            <div class="sample-tile" data-tile="s1">ğŸ€</div>
            <div class="sample-tile" data-tile="s9">ğŸ€˜</div>
            <div class="sample-tile" data-tile="east">ğŸ€€</div>
            <div class="sample-tile" data-tile="red">ğŸ€„</div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–è¯†åˆ«å™¨
        const recognizer = new MahjongRecognizer();
        let currentBase64 = '';
        
        // DOMå…ƒç´ 
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const tilePreview = document.getElementById('tilePreview');
        const resultArea = document.getElementById('resultArea');
        const resultContent = document.getElementById('resultContent');
        const loading = document.getElementById('loading');
        
        // æ ·æœ¬éº»å°†çš„Base64æ•°æ®
        const sampleTiles = {
            'm1': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CHPC90ZXh0Pjwvc3ZnPg==',
            'm5': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CPPC90ZXh0Pjwvc3ZnPg==',
            'p1': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CRPC90ZXh0Pjwvc3ZnPg==',
            'p9': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CZPC90ZXh0Pjwvc3ZnPg==',
            's1': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CVPC90ZXh0Pjwvc3ZnPg==',
            's9': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmNWY1ZjUiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb9udC1zaXplPSI0OCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+QnTwvdGV4dD48L3N2Zz4=',
            'east': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmZmMzYzMiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CA8L3RleHQ+PC9zdmc+',
            'red': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjE1MCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNmZjY2NjYiIHN0cm9rZT0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQ4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn5CEPC90ZXh0Pjwvc3ZnPg=='
        };
        
        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                await processImageFile(file);
            }
        });
        
        // æ‹–æ”¾å¤„ç†
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('dragover');
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('dragover');
        });
        
        dropArea.addEventListener('drop', async (e) => {
            e.preventDefault();
            dropArea.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                await processImageFile(file);
            }
        });
        
        // å¤„ç†å›¾ç‰‡æ–‡ä»¶
        async function processImageFile(file) {
            try {
                // è½¬æ¢ä¸ºBase64
                const base64 = await fileToBase64(file);
                currentBase64 = base64;
                
                // æ˜¾ç¤ºé¢„è§ˆ
                tilePreview.src = base64;
                previewArea.style.display = 'block';
                
                // å¼€å§‹è¯†åˆ«
                await recognizeTile(base64);
                
            } catch (error) {
                console.error('å¤„ç†å›¾ç‰‡å¤±è´¥:', error);
                alert('å¤„ç†å›¾ç‰‡å¤±è´¥: ' + error.message);
            }
        }
        
        // æ–‡ä»¶è½¬Base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // è¯†åˆ«éº»å°†
        async function recognizeTile(base64) {
            try {
                // æ˜¾ç¤ºåŠ è½½ä¸­
                loading.style.display = 'block';
                resultArea.style.display = 'none';
                
                // è°ƒç”¨è¯†åˆ«å™¨
                const result = await recognizer.recognize(base64);
                
                // æ˜¾ç¤ºç»“æœ
                displayResult(result);
                
            } catch (error) {
                console.error('è¯†åˆ«å¤±è´¥:', error);
                alert('è¯†åˆ«å¤±è´¥: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
        function displayResult(result) {
            resultArea.style.display = 'block';
            
            if (!result.success) {
                resultContent.innerHTML = `
                    <div class="result-card error">
                        <h4>âŒ è¯†åˆ«å¤±è´¥</h4>
                        <p>é”™è¯¯: ${result.error}</p>
                    </div>
                `;
                return;
            }
            
            const tile = result.tile;
            const confidence = (result.confidence * 100).toFixed(1);
            
            // è·å–éº»å°†ä¿¡æ¯
            const tileInfo = recognizer.tileFeatures[tile] || { type: 'unknown' };
            
            // ä¸­æ–‡åç§°æ˜ å°„
            const tileNames = {
                'm1': 'ä¸€ä¸‡', 'm2': 'äºŒä¸‡', 'm3': 'ä¸‰ä¸‡', 'm4': 'å››ä¸‡', 'm5': 'äº”ä¸‡',
                'm6': 'å…­ä¸‡', 'm7': 'ä¸ƒä¸‡', 'm8': 'å…«ä¸‡', 'm9': 'ä¹ä¸‡',
                'p1': 'ä¸€ç­’', 'p2': 'äºŒç­’', 'p3': 'ä¸‰ç­’', 'p4': 'å››ç­’', 'p5': 'äº”ç­’',
                'p6': 'å…­ç­’', 'p7': 'ä¸ƒç­’', 'p8': 'å…«ç­’', 'p9': 'ä¹ç­’',
                's1': 'ä¸€æ¡', 's2': 'äºŒæ¡', 's3': 'ä¸‰æ¡', 's4': 'å››æ¡', 's5': 'äº”æ¡',
                's6': 'å…­æ¡', 's7': 'ä¸ƒæ¡', 's8': 'å…«æ¡', 's9': 'ä¹æ¡',
                'east': 'ä¸œé£', 'south': 'å—é£', 'west': 'è¥¿é£', 'north': 'åŒ—é£',
                'red': 'çº¢ä¸­', 'green': 'å‘è´¢', 'white': 'ç™½æ¿'
            };
            
            // ç±»å‹æ˜ å°„
            const typeNames = {
                'character': 'ä¸‡å­',
                'dot': 'ç­’å­',
                'bamboo': 'æ¡å­', 
                'wind': 'é£ç‰Œ',
                'dragon': 'ä¸‰å…ƒç‰Œ'
            };
            
            const tileName = tileNames[tile] || 'æœªçŸ¥ç‰Œ';
            const typeName = typeNames[tileInfo.type] || 'æœªçŸ¥ç±»å‹';
            const typeClass = tileInfo.type || 'unknown';
            
            resultContent.innerHTML = `
                <div class="result-card">
                    <h3>ğŸ¯ è¯†åˆ«ç»“æœ</h3>
                    <div class="tile-info">${tileName}</div>
                    <div>
                        <span class="tile-type ${typeClass}">${typeName}</span>
                        <span class="tile-type confidence">ç½®ä¿¡åº¦: ${confidence}%</span>
                    </div>
                    
                    <h4 style="margin-top: 20px;">ğŸ” ç‰¹å¾åˆ†æ</h4>
                    <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto;">
${JSON.stringify(result.features, null, 2)}
                    </pre>
                    
                    <button onclick="copyResult()" style="margin-top: 15px;">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                </div>
            `;
        }
        
        // å¤åˆ¶ç»“æœ
        function copyResult() {
            const resultText = resultContent.textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // æ ·æœ¬æµ‹è¯•
        document.querySelectorAll('.sample-tile').forEach(tile => {
            tile.addEventListener('click', () => {
                const tileId = tile.getAttribute('data-tile');
                const base64 = sampleTiles[tileId];
                
                if (base64) {
                    tilePreview.src = base64;
                    previewArea.style.display = 'block';
                    recognizeTile(base64);
                }
            });
        });
        
        // æ·»åŠ æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            .confidence { background: #667eea !important; }
            .error { background: #fee; color: #c00; }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
