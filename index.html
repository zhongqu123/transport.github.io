<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å­˜å‚¨ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        
        .api-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }
        
        .api-info h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .test-interface {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .json-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æ–‡æœ¬å­˜å‚¨ç³»ç»Ÿ</h1>
        
        <div class="api-info">
            <h3>API ä½¿ç”¨è¯´æ˜</h3>
            <p><strong>URLæ ¼å¼:</strong> <code>zhongqu123.github.io/transport.github.io?accounts=ç”¨æˆ·å&mode=æ¨¡å¼&text=æ–‡æœ¬</code></p>
            
            <div class="code-block">
// å†™å…¥æ–‡æœ¬
https://zhongqu123.github.io/transport.github.io/?accounts=å¼ ä¸‰&mode=w&text=ä½ å¥½ä¸–ç•Œ

// è¯»å–æ–‡æœ¬  
https://zhongqu123.github.io/transport.github.io/?accounts=å¼ ä¸‰&mode=r

// ç»­å†™æ–‡æœ¬
https://zhongqu123.github.io/transport.github.io/?accounts=å¼ ä¸‰&mode=cw&text=è¿™æ˜¯è¿½åŠ çš„å†…å®¹
            </div>
            
            <p><strong>æ¨¡å¼è¯´æ˜:</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><code>r</code> - è¯»å–ï¼šè·å–æŒ‡å®šè´¦å·çš„æ–‡æœ¬å†…å®¹</li>
                <li><code>w</code> - å†™å…¥ï¼šè¦†ç›–å†™å…¥æ–°æ–‡æœ¬ï¼ˆéœ€è¦textå‚æ•°ï¼‰</li>
                <li><code>cw</code> - ç»­å†™ï¼šåœ¨ç°æœ‰æ–‡æœ¬åè¿½åŠ å†…å®¹ï¼ˆéœ€è¦textå‚æ•°ï¼‰</li>
            </ul>
        </div>

        <div class="test-interface">
            <h3>ğŸ§ª æµ‹è¯•æ¥å£</h3>
            
            <div class="input-group">
                <label for="accounts">è´¦å· (accounts):</label>
                <input type="text" id="accounts" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="testuser">
            </div>
            
            <div class="input-group">
                <label for="mode">æ¨¡å¼ (mode):</label>
                <select id="mode">
                    <option value="r">è¯»å– (r)</option>
                    <option value="w">å†™å…¥ (w)</option>
                    <option value="cw">ç»­å†™ (cw)</option>
                </select>
            </div>
            
            <div class="input-group" id="textInputGroup">
                <label for="text">æ–‡æœ¬å†…å®¹ (text):</label>
                <input type="text" id="text" placeholder="è¯·è¾“å…¥è¦å­˜å‚¨çš„æ–‡æœ¬" value="è¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡æœ¬">
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="testAPI()">æµ‹è¯•API</button>
                <button class="btn-secondary" onclick="generateURL()">ç”ŸæˆURL</button>
            </div>
            
            <div id="urlResult" class="result">
                <h4>ç”Ÿæˆçš„URL:</h4>
                <div class="code-block" id="generatedURL"></div>
                <button class="copy-btn" onclick="copyURL()">å¤åˆ¶URL</button>
            </div>
            
            <div id="apiResult" class="result">
                <h4>APIå“åº”:</h4>
                <div class="json-result" id="jsonResult"></div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶å¤„ç†URLå‚æ•°
        window.addEventListener('load', function() {
            processURLParameters();
            updateUI();
        });
        
        // æ ¹æ®æ¨¡å¼æ˜¾ç¤º/éšè—æ–‡æœ¬è¾“å…¥æ¡†
        function updateUI() {
            const mode = document.getElementById('mode').value;
            const textInputGroup = document.getElementById('textInputGroup');
            
            if (mode === 'r') {
                textInputGroup.style.display = 'none';
            } else {
                textInputGroup.style.display = 'block';
            }
        }
        
        // å¤„ç†URLå‚æ•°ï¼ˆä»…åœ¨é€šè¿‡URLç›´æ¥è®¿é—®APIæ—¶ç”Ÿæ•ˆï¼‰
        function processURLParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const accounts = urlParams.get('accounts');
            const mode = urlParams.get('mode');
            const text = urlParams.get('text');
            
            // åªæœ‰å½“é¡µé¢æ˜¯é€šè¿‡API URLç›´æ¥è®¿é—®æ—¶ï¼ˆæœ‰å®Œæ•´å‚æ•°ï¼‰ï¼Œæ‰è¾“å‡ºJSON
            if (accounts && mode && window.location.hash !== '#test') {
                executeAPIOperationForURL(accounts, mode, text);
            }
        }
        
        // ä¸“é—¨ç”¨äºURLè®¿é—®çš„APIæ‰§è¡Œå‡½æ•°ï¼ˆä¼šæ›¿æ¢é¡µé¢å†…å®¹ï¼‰
        function executeAPIOperationForURL(accounts, mode, text) {
            let result;
            
            try {
                // å‚æ•°éªŒè¯
                if (!accounts) {
                    throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°: accounts');
                }
                
                if (!mode) {
                    throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°: mode');
                }
                
                if (mode !== 'r' && !text) {
                    throw new Error(`æ¨¡å¼ "${mode}" éœ€è¦ text å‚æ•°`);
                }
                
                // æ‰§è¡Œæ“ä½œ
                switch(mode) {
                    case 'r':
                        result = readText(accounts);
                        break;
                    case 'w':
                        result = writeText(accounts, text);
                        break;
                    case 'cw':
                        result = appendText(accounts, text);
                        break;
                    default:
                        throw new Error(`ä¸æ”¯æŒçš„æ¨¡å¼: ${mode}`);
                }
                
                // è¿”å›JSONå“åº”ï¼ˆæ›¿æ¢é¡µé¢å†…å®¹ï¼‰
                returnJSONResponse(result);
                
            } catch (error) {
                returnJSONResponse({
                    status: 'error',
                    message: error.message,
                    timestamp: new Date().toISOString()
                });
            }
        }
        
        // ç”¨äºé¡µé¢å†…æµ‹è¯•çš„APIæ‰§è¡Œå‡½æ•°ï¼ˆä¸æ›¿æ¢é¡µé¢å†…å®¹ï¼‰
        function executeAPIOperation(accounts, mode, text) {
            let result;
            
            try {
                // å‚æ•°éªŒè¯
                if (!accounts) {
                    throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°: accounts');
                }
                
                if (!mode) {
                    throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°: mode');
                }
                
                if (mode !== 'r' && !text) {
                    throw new Error(`æ¨¡å¼ "${mode}" éœ€è¦ text å‚æ•°`);
                }
                
                // æ‰§è¡Œæ“ä½œ
                switch(mode) {
                    case 'r':
                        result = readText(accounts);
                        break;
                    case 'w':
                        result = writeText(accounts, text);
                        break;
                    case 'cw':
                        result = appendText(accounts, text);
                        break;
                    default:
                        throw new Error(`ä¸æ”¯æŒçš„æ¨¡å¼: ${mode}`);
                }
                
                return result;
                
            } catch (error) {
                return {
                    status: 'error',
                    message: error.message,
                    timestamp: new Date().toISOString()
                };
            }
        }
        
        // è¯»å–æ–‡æœ¬
        function readText(accounts) {
            const storageKey = `text_storage_${accounts}`;
            const storedData = localStorage.getItem(storageKey);
            
            if (!storedData) {
                return {
                    status: 'success',
                    mode: 'r',
                    accounts: accounts,
                    text: '',
                    message: 'è´¦å·ä¸å­˜åœ¨æˆ–æ²¡æœ‰å­˜å‚¨å†…å®¹',
                    timestamp: new Date().toISOString(),
                    exists: false
                };
            }
            
            const data = JSON.parse(storedData);
            return {
                status: 'success',
                mode: 'r',
                accounts: accounts,
                text: data.text,
                createdAt: data.createdAt,
                lastModified: data.lastModified,
                timestamp: new Date().toISOString(),
                exists: true
            };
        }
        
        // å†™å…¥æ–‡æœ¬ï¼ˆè¦†ç›–ï¼‰
        function writeText(accounts, text) {
            const storageKey = `text_storage_${accounts}`;
            const now = new Date().toISOString();
            
            const data = {
                text: text,
                createdAt: now,
                lastModified: now,
                accessCount: 0
            };
            
            localStorage.setItem(storageKey, JSON.stringify(data));
            
            return {
                status: 'success',
                mode: 'w',
                accounts: accounts,
                text: text,
                message: 'æ–‡æœ¬å†™å…¥æˆåŠŸ',
                timestamp: now,
                operation: 'overwrite'
            };
        }
        
        // ç»­å†™æ–‡æœ¬ï¼ˆè¿½åŠ ï¼‰
        function appendText(accounts, text) {
            const storageKey = `text_storage_${accounts}`;
            const storedData = localStorage.getItem(storageKey);
            const now = new Date().toISOString();
            
            let data;
            if (storedData) {
                data = JSON.parse(storedData);
                data.text += text;
                data.lastModified = now;
            } else {
                data = {
                    text: text,
                    createdAt: now,
                    lastModified: now,
                    accessCount: 0
                };
            }
            
            localStorage.setItem(storageKey, JSON.stringify(data));
            
            return {
                status: 'success',
                mode: 'cw',
                accounts: accounts,
                text: data.text,
                appendedText: text,
                message: 'æ–‡æœ¬ç»­å†™æˆåŠŸ',
                timestamp: now,
                operation: 'append'
            };
        }
        
        // è¿”å›JSONå“åº”ï¼ˆä»…ç”¨äºURLè®¿é—®æ—¶ï¼‰
        function returnJSONResponse(data) {
            // è®¾ç½®å“åº”å¤´ï¼ˆè™½ç„¶GitHub Pagesæ— æ³•ä¿®æ”¹HTTPå¤´ï¼Œä½†æµè§ˆå™¨èƒ½æ­£ç¡®è§£æå†…å®¹ï¼‰
            try {
                document.contentType = "application/json";
            } catch(e) {}
            
            // ç›´æ¥è¾“å‡ºJSON
            document.body.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        // æµ‹è¯•APIåŠŸèƒ½
        function testAPI() {
            const accounts = document.getElementById('accounts').value;
            const mode = document.getElementById('mode').value;
            const text = mode === 'r' ? null : document.getElementById('text').value;
            
            const result = executeAPIOperation(accounts, mode, text);
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('apiResult');
            const jsonResult = document.getElementById('jsonResult');
            
            jsonResult.textContent = JSON.stringify(result, null, 2);
            resultDiv.style.display = 'block';
            // æ ¹æ®ç»“æœçŠ¶æ€è®¾ç½®æ ·å¼
            resultDiv.className = `result ${result.status === 'success' ? 'success' : 'error'}`;
        }
        
        // ç”ŸæˆURL
        function generateURL() {
            const accounts = document.getElementById('accounts').value;
            const mode = document.getElementById('mode').value;
            const text = mode === 'r' ? null : document.getElementById('text').value;
            
            if (!accounts || !mode) {
                alert('è¯·å¡«å†™è´¦å·å’Œæ¨¡å¼');
                return;
            }
            
            if (mode !== 'r' && !text) {
                alert('è¯¥æ¨¡å¼éœ€è¦å¡«å†™æ–‡æœ¬å†…å®¹');
                return;
            }
            
            let url = `https://zhongqu123.github.io/transport.github.io/?accounts=${encodeURIComponent(accounts)}&mode=${mode}`;
            
            if (text) {
                url += `&text=${encodeURIComponent(text)}`;
            }
            
            const urlResult = document.getElementById('urlResult');
            const generatedURL = document.getElementById('generatedURL');
            
            generatedURL.textContent = url;
            urlResult.style.display = 'block';
        }
        
        // å¤åˆ¶URL
        function copyURL() {
            const url = document.getElementById('generatedURL').textContent;
            navigator.clipboard.writeText(url).then(() => {
                alert('URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // ç›‘å¬æ¨¡å¼å˜åŒ–
        document.getElementById('mode').addEventListener('change', updateUI);
    </script>
</body>
</html>
